<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>价值多少万吧~</title>
<meta name="description" content="要不要发给老板呢……"/>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'/>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/Swiper/4.1.6/css/swiper.min.css">
<script type="text/javascript" src="https://cdn.bootcss.com/Swiper/4.1.6/js/swiper.min.js"></script>
<link rel="stylesheet" type="text/css" href="css/base.css">
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
<script>
(function (win,doc){
    if (!win.addEventListener) return;
    var html=document.documentElement;
    function setFont()
    {
        var cliWidth=html.clientWidth;
        html.style.fontSize=100*(cliWidth/750)+'px';
    }
    win.addEventListener('resize',setFont,false);
    setFont();
})(window,document);
</script>
</head>
<body>
<div class="imgS"><img src="images/weixin.jpg"></div>
<div class="loadPage On" style="z-index:99999;">
    <div class="bg0"></div>
    <div class="loading m">
        <div class="loading-num"><b id="nnn">0</b>%</div>
    </div>
  <!--版权信息-->
</div>
<div class="swiper-container" style="opacity:0;">
    <!--音乐-->
    <div id="audio_btn" class="u-audio u-play">
        <div class="rotate"></div><audio style="display:none;" preload="preload" controls id="car_audio" src="images/music.mp3" loop></audio>
    </div>

    <div class="swiper-wrapper">
        <!-- 第6屏 -->
        <section class="swiper-slide slide1 stopSwiper">
          <span class="bg3"></span>
          <div class="Btn canvasBtn">生成测试结果</div>
        </section>

        <!-- 第7屏 -->
        <section class="swiper-slide slide2 stopSwiper">
              <div class="slide7Wrap" id="targetDom">
                <img id="screenShotImg">
                <div class="ResultDiv ResultShare">
                    <p class="weixinUser"><span class="headimgurl"><img src="images/weixin.jpg" /></span><span> 你好，</span><span class="nickname">我</span></p>
                    <div class="SexB "><span class=""></span></div>
                    <div class="GG">
                      <p class="sj sj100" rel="100">天生领导者，你思想独立，追求完美，能带领团队攻克重要难题，你是他们的主心骨！</p>
                      <p class="sj sj80" rel="80">炙热潜力股，你相信一分耕耘就有一分收获，只差一个机会你就能一飞冲天！</p>
                      <p class="sj sj50" rel="50">厚积薄发者，你未来的财富可不止如此，2019年pick一招职场大杀器吧！</p>
                      <p class="sj sj20" rel="20">城市新青年，你知足安乐，年轻时不妨发掘潜力，更好的自己会让你惊叹呦！</p>
                    </div>
                    <div class="weixinCode"><img src="images/qrcode.png"></div>
                </div>
              </div>

              <div class="slide7Wrap">
                <div class="ResultDiv">
                    <p class="weixinUser"><span class="headimgurl"><img src="images/weixin.jpg" /></span><span> 你好，</span><span class="nickname n_name">我</span></p>
                    <div class="SexB SZ"><span id="id_sex" class="n_sex">100</span></div>
                    <div class="GG">
                      <p class="sj sj100" rel="100">天生领导者，你思想独立，追求完美，能带领团队攻克重要难题，你是他们的主心骨！</p>
                      <p class="sj sj80" rel="80">炙热潜力股，你相信一分耕耘就有一分收获，只差一个机会你就能一飞冲天！</p>
                      <p class="sj sj50" rel="50">厚积薄发者，你未来的财富可不止如此，2019年pick一招职场大杀器吧！</p>
                      <p class="sj sj20" rel="20">城市新青年，你知足安乐，年轻时不妨发掘潜力，更好的自己会让你惊叹呦！</p>
                    </div>
                    <div class="BtnTool">
                      <span class="Retest">再测一次</span>
                      <span class="cityMark">炫耀一下</span>
                    </div>
                    <p class="w_a"></p>
                </div>
                <p class="unlockWork">解锁职场秘籍</p>
              </div>


        </section>
    </div>
</div>

<!--弹出视频 /S-->
<div class="popup_video">
  <div class="popup_close"></div>
  <div id="pop_mod_player"></div>
</div>
<!--弹出视频 /E--> 
<script type="text/javascript" src="js/zepto.min.js"></script>
<script type="text/javascript" src="js/html2canvas.js"></script>

<script>

/**
 * 截图功能
 * targetDom 要克隆的目标dom元素
 * cb 回调函数
*/
function screenShot(targetDom,cb){
    var copyDom = targetDom.clone();//克隆dom节点
    copyDom.css('display','block');
    $('body').append(copyDom);//把copy的截图对象追加到body后面
    var width = copyDom.width();//dom宽
    var height = copyDom.height();//dom高
    var scale = 1.5;//放大倍数
    var canvas = document.createElement('canvas');
    canvas.width = width*scale;//canvas宽度
    canvas.height = height*scale;//canvas高度
    var content = canvas.getContext("2d");
    content.scale(scale,scale);
    var rect = copyDom.get(0).getBoundingClientRect();//获取元素相对于视察的偏移量
    content.translate(-rect.left,-rect.top);//设置content位置，值为相对于视窗的偏移量负值，让图片复位
    html2canvas(copyDom, {
        useCORS:true,
        tainTest:true,
        scale:scale,
        canvas:canvas,
        width:width,
        heigth:height,
        onrendered: function(canvas) {
            if(cb){
                copyDom.css('display','none');
                cb(canvas.toDataURL("image/png"),width,height);
            }
        }
    });
}
</script>
<script>
/**
 * loadImg  图片预加载
 * @param   {Array}     预加载图片的对象数组
*/
var pics = [
    "images/hand.png",
    "images/gold1.gif",
];

function _loadImages(pics,callback,len){
    len = len || pics.length;
    if(pics.length){
        var IMG = new Image(),
            picelem = pics.shift();

        if(window._pandaImageLoadArray){
            window._pandaImageLoadArray = window._pandaImageLoadArray
        }else{
            window._pandaImageLoadArray = [];
        }
        window._pandaImageLoadArray.push(picelem);
        IMG.src = picelem;
        // 从数组中取出对象的一刻，就开始变化滚动条
        _drawLoadProgress(window._pandaImageLoadArray.length/(len*len));
        // 缓存处理
        if (IMG.complete) {
            window._pandaImageLoadArray.shift();
            return _loadImages(pics,callback, len); 
        }else{
            // 加载处理
            IMG.onload = function() {
                window._pandaImageLoadArray.shift();
                IMG.onload = null;  // 解决内存泄漏和GIF图多次触发onload的问题
            }
            // 容错处理 todo 应该如何处理呢?
            // 目前是忽略这个错误，不影响正常使用
            IMG.onerror = function(){
                window._pandaImageLoadArray.shift();
                IMG.onerror = null;
            }
            return _loadImages(pics, callback, len);
        }
        return;
    }
    if(callback) _loadProgress(callback, window._pandaImageLoadArray.length, len);
}

// 监听实际的加载情况
function _loadProgress(callback, begin, all){
    var loadinterval = setInterval(function(){
        if(window._pandaImageLoadArray.length != 0 && window._pandaImageLoadArray.length != begin){
            _drawLoadProgress((begin - window._pandaImageLoadArray.length )/all);
        }else if(window._pandaImageLoadArray.length == 0){
            _drawLoadProgress(1)
            setTimeout(function(){
                callback.call(window);
            },500);
            clearInterval(loadinterval);
        }
    },300);
}

function _drawLoadProgress(w){
    var num = Math.floor(w*100) >= 100 ? 100 : Math.floor(w*100);
    $('.loading-progress').animate({width:num+"%"}, 100, 'linear');
    $(".loading-num b").html(num);
}

// 调用
_loadImages(pics,function(){
  setTimeout(function(){
    $(".loadPage").hide();
    $(".swiper-container").css('opacity','1');
    $(".slide1").addClass('active');
  },0);
  setTimeout(function(){
    $(".slide1").addClass('active');
  },200);
});


var mySwiper = new Swiper ('.swiper-container',{
  effect : 'fade',
  direction : 'vertical',
  pagination: '.swiper-pagination',
  //nextButton: '.next',
  mousewheelControl : true,
  //loop : true,
  noSwiping: true,
  noSwipingClass: "stopSwiper",
  on: {
    slideChangeTransitionEnd: function(){
      var i = this.activeIndex;
        //console.log(i);
        $(".Vm").removeClass("on").hide();
        $(".slide1").removeClass("active");

        if (i == 0 ){
          $(".slide1").addClass('active');
        }

        if (i != 1){


        }
        if (i == 2){
        }

    },
  }

})


$(".Sex label input:radio").bind('click',function(){
    var sex = $(this).val();
    console.log(sex);
    $(".SexB").addClass(sex)/*.html(sex)*/;
    mySwiper.slideNext();
});


$(".w1_btn").bind('click',function(){
    mySwiper.slideNext();
});

$('.QA .A').each(function(){
    $(this).find('label').each(function(){
        $(this).on('click',function(){
            $(this).parent().addClass("Cur").siblings().removeClass('Cur');
        });
    })
});


$('.An:radio').bind('click',function(){
    var val = $(this).val();
    //console.log(val);
  var sum = 0;
  $.each($("input.An[type='radio']:checked"),function(){
      sum += parseInt(this.value);
  });
  console.log(sum);
  if (sum >= 7){
      $(".sj").hide();
      $(".sj100").fadeIn("fast");
  }
  if ( 6 >= sum && sum >= 5) {
      $(".sj").hide();
      $(".sj80").fadeIn("fast");
  }
  if ( 4 >= sum && sum >= 2) {
      $(".sj").hide();
      $(".sj50").fadeIn("fast");
  }
  if ( 1 >= sum && sum >= 0) {
      $(".sj").hide();
      $(".sj20").fadeIn("fast");
  }
});


$('.Ans:radio').bind('click',function(){
    setTimeout(function(){
       mySwiper.slideNext();
    },100);
});


$('.AnsS:radio').bind('click',function(){
    $(".Btn").fadeIn('slow');
});


$(".canvasBtn").bind("click",function(){
    mySwiper.slideNext();

    var sum = 0;
    $.each($("input.An[type='radio']:checked"),function(){
        sum += parseInt(this.value);
    });
    if (sum >= 7){
        $(".SexB").addClass('SexB100');
        $(".SexB span").addClass('n_sex f100').html("100");
    }
    if ( 6 >= sum && sum >= 5) {
        $(".SexB").addClass('SexB80');
        $(".SexB span").addClass('n_sex f80').html("80");
    }
    if ( 4 >= sum && sum >= 2) {
        $(".SexB").addClass('SexB50');
        $(".SexB span").addClass('n_sex f50').html("50");
    }
    if ( 1 >= sum && sum >= 0) {
        $(".SexB").addClass('SexB20');
        $(".SexB span").addClass('n_sex f20').html("20");
    }


    screenShot($('#targetDom'),function(canvas,width,height){
        $("#screenShotImg").attr({
          src:canvas
        });
        $("#targetDom").css({
          left: 0
        });
        $("#screenShotImg").css({
          width: width,
          height: height,
          left:0
        });;
        $(".w_a").fadeIn('slow');
    });



});

//再测一次
$(".Retest").bind('click',function(){
    //window.location.reload();
    window.location.href = linkUrl;
});
//炫耀一下
$(".cityMark").bind('click',function(){
  $(".topShare").show().css("opacity","1");
});
$(".topShare").bind('click',function(){
  $(this).hide().css("opacity","0");
});
//解锁职场
$(".unlockWork").bind('click',function(){
  window.location.href = 'http://www.xuexi.com.cn/special/popularize1709/';
});


$(".vv").bind("click",function(){
  var _src = $(this).find('img').attr('bigpic'),
      _txt = $(this).find('img').attr('bigtxt');
     $(".bigPicshow").show().addClass("cur").css("background-image","url("+_src+")");
     $(".bigPicshow .picTxt").html(_txt);
})
$(".bigPicshow,.picClose").bind("click",function(){
    $(".bigPicshow").removeClass('cur').hide();
    $(".bigPicshow .picTxt").html("");
})

$(function(){
  $(".vPic").bind("click",function(){
    $(".Vm").removeClass("on").hide();
    $(this).next(".Vm:first").addClass("on").show();
  });
  $(".Vm .Close").bind("click",function(){
      $(".Vm").removeClass("on").hide();
  });
})
</script>
</body>
</html>